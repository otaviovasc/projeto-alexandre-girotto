<%= form_with model: @reserva, url: admin_reservas_path, local: true do |form| %>
  <div>
    <label>Create New User?</label>
    <%= check_box_tag 'create_user', 'true', false, id: 'create_user_toggle' %>
  </div>

  <div id="new_user_fields" style="display:none;">
    <h3>New User Details</h3>
    <div>
      <%= label_tag :name, "Name" %>
      <%= text_field_tag 'user[name]', nil, class: 'form-control' %>
    </div>
    <div>
      <%= label_tag :email, "Email" %>
      <%= text_field_tag 'user[email]', nil, class: 'form-control' %>
    </div>
  </div>

  <div id="existing_user_fields">
    <%= form.label :user_id, "Select User" %>
    <%= form.collection_select :user_id, User.all, :id, :email %>
  </div>

  <div>
    <%= form.label :cabana %>
    <%= form.collection_select :cabana_id, Cabana.all, :id, :name %>
  </div>

  <div>
    <%= form.label :start_date %>
    <%= form.date_select :start_date %>
  </div>

  <div>
    <%= form.label :end_date %>
    <%= form.date_select :end_date %>
  </div>

  <div>
    <%= form.submit 'Create Reserva', class: 'btn btn-primary' %>
  </div>
<% end %>

<%= link_to 'Back', admin_reservas_path %>

<script>
  document.addEventListener('turbo:load', function() {
    const toggle = document.getElementById('create_user_toggle');
    const newUserFields = document.getElementById('new_user_fields');
    const existingUserFields = document.getElementById('existing_user_fields');

    toggle.addEventListener('change', function() {
      if (toggle.checked) {
        newUserFields.style.display = 'block';
        existingUserFields.style.display = 'none';
      } else {
        newUserFields.style.display = 'none';
        existingUserFields.style.display = 'block';
      }
    });
  });
</script>
